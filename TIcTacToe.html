<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Tic Tac Toe!</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</head>

<body>
  <main class="text-center">
    <!--START OF WHITEBOARD -->
    <div id="whiteboard">
      <h1 id="title1">Swole Papi's Tic Tac Toe Game!</h1>
      <h3 id="title2">Free Code Camp Advanced Front End Project</h3>
      <table class="winCount">
        <tr>
          <td class="br bb">Player 1</td>
          <td class="bb aiORp2"></td>
        </tr>
        <tr>
          <td class="br p1WinCount">0</td>
          <td class="aiORp2WinCount">0</td>
        </tr>
      </table>
      <hr>
      <div id="winner"></div>
      <div class="playerOneTurn">Player 1</div>
      <div class="playerTwoTurn">Player 2</div>
      <!--PLAYERS - FIND NUM OF PLAYERS -->
      <div id="players">How many players?
        <div><a id="oneP" href="#">One Player</a></div>
        <div><a id="twoP" href="#">Two Players</a></div>
      </div>
      <!--END OF PLAYERS -->

      <!--CHOOSE X OR O -->
      <div id="xo">Would you like to be X or O?
        <br>
        <div><a id="X" href="#">X</a></div>
        <div><a id="O" href="#">O</a></div>
      </div>
      <!--END OF X OR O -->

      <!--START OF GAMEBOARD -->
      <table id="gameboard">
        <tr>
          <td id="grid0" class="br bb"></td>
          <td id="grid1" class="br bb"></td>
          <td id="grid2" class="bb"></td>
        </tr>
        <tr>
          <td id="grid3" class="br bb"></td>
          <td id="grid4" class="br bb"></td>
          <td id="grid5" class="bb"></td>
        </tr>
        <tr>
          <td id="grid6" class="br"></td>
          <td id="grid7" class="br"></td>
          <td id="grid8"></td>
        </tr>
      </table>
      <!--END OF GAMEBOARD -->
    </div>
    <!--END OF WHITEBOARD -->
    <br>
    <!--RESET BUTTON -->
    <button id="resetbtn" class="btn btn-info btn-lg">Reset</button>
    <!--END OF RESET BUTTON -->
  </main>
</body>

</html>

<script type="text/javascript">
  $(document).ready(function() {
    $("#gameboard").hide();
    $("#xo").hide();
    $("#winner").hide();
    $(".playerOneTurn").hide();
    $(".playerTwoTurn").hide();
    $(".winCount").css({
      opacity: 0
    });

    var numPlayers = 0; //stores number of players
    var p1xo; //stores whether p1 is 'X' or 'O'
    var p2xo; //stores whether p1 is 'X' or 'O'
    var turn = 0; //turn counter
    var el; //used with prefix to set mark on a grid position
    var prefix = 'grid';
    var spots = [0, 0, 0, 0, 0, 0, 0, 0, 0]; //array of spots for checkWin conditions
    var empty = ['6', '2', '0', '1', '3', '4', '8', '5', '7']; //array for empty grid spaces
    var lastDigit; //gets the digit off grid id
    var p1Mark = [];
    var p2Mark = [];
    var computerGo; //true/false variable for the AI turn
    var win;  //variable to stop game if there is a win or draw
    var turnTime = 350;
    var p1WinCount = 0;
    var p2WinCount = 0;
    var computerWinCount = 0;

    //CHOOSES NUMBER OF PLAYERS
    $("#oneP").click(function() {
      numPlayers = 1;
      $("#players").hide();
      $("#xo").show();
      $(".aiORp2").html("Computer");
    });
    $("#twoP").click(function() {
      numPlayers = 2;
      $("#players").hide();
      $("#xo").show();
      $(".aiORp2").html("Player 2");
    });

    //P1 CHOOSES X OR O
    $("#X").click(function() {
      p1xo = "X";
      p2xo = "O";
      $("#xo").hide();
      $("#gameboard").show();
      $('.playerOneTurn').animate({
        width: 'toggle'
      }, turnTime);
      $(".winCount").fadeTo( "slow", 1 );
    });
    $("#O").click(function() {
      p1xo = "O";
      p2xo = "X";
      $("#xo").hide();
      $("#gameboard").show();
      $('.playerOneTurn').animate({
        width: 'toggle'
      }, turnTime);
      $(".winCount").fadeTo( "slow", 1 );
    });

    //RESET BUTTON LOGIC
    $('#resetbtn').click(function() {
      resetAll();
    });

    $("td").on("click", function() {
      //GAMEPLAY FOR ONE PLAYER
      if (numPlayers === 1 && turn < 9) {
        if ( document.getElementById(this.id).innerHTML === "" ) { //makes sure spot is empty first
          computerGo = false;
          document.getElementById(this.id).innerHTML = p1xo; //sets p1 marker at the clicked location
          turn++; //increments turn
          checkWin(); //checks to see if p1 has won
          if (win === true) {
            return;
          }
          $('.playerOneTurn').animate({
            width: 'toggle'
          }, turnTime);
          $('.playerTwoTurn').animate({
            width: 'toggle'
          }, turnTime);
          $( "#gameboard" ).css( 'pointer-events', 'none' ); //disables clicking during computer turn
          lastDigit = this.id.substr(-1); //grabs digit from grid id
          setTimeout(function() {
            p1Mark.push(lastDigit); //adds grid location to array of p1 marks
            empty.splice(empty.indexOf(lastDigit), 1); //removes the clicked location from array of empty spots
            almostWin(); //checks to see if user/AI has almost won before AI chooses a spot and if not sets computerGo to 1
            if (computerGo === true) { //denotes that it is the AI's turn and user/AI is not in a position to win
              el = document.getElementById(prefix + empty[0]); //sets el as the id of the first grid space in empty array
              $(el).html(p2xo); //puts AI mark in that space
              p2Mark.push(empty[0]); //adds the first value of empty to the array of spots for the AI
              empty.shift(); //removes the first value of empty since that spot has been taken
            }
            $('.playerOneTurn').animate({
              width: 'toggle'
            }, turnTime);
            $('.playerTwoTurn').animate({
              width: 'toggle'
            }, turnTime);
            $( "#gameboard" ).css( 'pointer-events', 'auto' ); //re-enables clicking after computer turn
            turn++; //increments turn
            checkWin(); //checks to see if AI has won
          }, 1200);
        }
      }

      //GAMEPLAY FOR TWO PLAYERS
      else if (numPlayers === 2 && turn < 9) {
        if (turn % 2 === 0) { //if turn is even, p1 goes
          if ( document.getElementById(this.id).innerHTML === "" ) {
            document.getElementById(this.id).innerHTML = p1xo; //sets p1 marker at the clicked location
            turn++; //increments turn
            $('.playerOneTurn').animate({
              width: 'toggle'
            }, turnTime);
            $('.playerTwoTurn').animate({
              width: 'toggle'
            }, turnTime);
            checkWin(); //checks if p1 has won
            if (win === true) {
              return;
            }
          }
        } else { //if turn is odd, p2 goes
          if ( document.getElementById(this.id).innerHTML === "" ) {
            document.getElementById(this.id).innerHTML = p2xo; //sets p2 marker at the clicked location
            turn++; //increments turn
            $('.playerOneTurn').animate({
              width: 'toggle'
            }, turnTime);
            $('.playerTwoTurn').animate({
              width: 'toggle'
            }, turnTime);
            checkWin(); //checks if p2 has won
          }
        }
      }
    });

    //checkWin FUNCTION
    function checkWin() {
      for (var i = 0; el = document.getElementById(prefix + i); i++) { //since prefix is 'grid', checks from grid0 - grid9
        if ($(el).text() === p1xo) { //if that grid space = p1
          spots.splice(i, 1, 1); //replace the 0 in spots array with a 1 at i's location
        } else if ($(el).text() === p2xo) { //if that grid space = p2
          spots.splice(i, 1, 2); //replace the 0 in spots array with a 2 at i's location
        }
      }
      //Goes through all possible win combinations and displays winner if conditions met
      if (spots[0] === 1 && spots[1] === 1 && spots[2] === 1) {
        p1Win(0,1,2);
      } else if (spots[3] === 1 && spots[4] === 1 && spots[5] === 1) {
        p1Win(3,4,5);
      } else if (spots[6] === 1 && spots[7] === 1 && spots[8] === 1) {
        p1Win(6,7,8);
      } else if (spots[0] === 1 && spots[3] === 1 && spots[6] === 1) {
        p1Win(0,3,6);
      } else if (spots[1] === 1 && spots[4] === 1 && spots[7] === 1) {
        p1Win(1,4,7);
      } else if (spots[2] === 1 && spots[5] === 1 && spots[8] === 1) {
        p1Win(2,5,8);
      } else if (spots[0] === 1 && spots[4] === 1 && spots[8] === 1) {
        p1Win(0,4,8);
      } else if (spots[2] === 1 && spots[4] === 1 && spots[6] === 1) {
        p1Win(2,4,6);
      } else if (spots[0] === 2 && spots[1] === 2 && spots[2] === 2) {
        p2Win(0,1,2);
      } else if (spots[3] === 2 && spots[4] === 2 && spots[5] === 2) {
        p2Win(3,4,5);
      } else if (spots[6] === 2 && spots[7] === 2 && spots[8] === 2) {
        p2Win(6,7,8);
      } else if (spots[0] === 2 && spots[3] === 2 && spots[6] === 2) {
        p2Win(0,3,6);
      } else if (spots[1] === 2 && spots[4] === 2 && spots[7] === 2) {
        p2Win(1,4,7);
      } else if (spots[2] === 2 && spots[5] === 2 && spots[8] === 2) {
        p2Win(2,5,8);
      } else if (spots[0] === 2 && spots[4] === 2 && spots[8] === 2) {
        p2Win(0,4,8);
      } else if (spots[2] === 2 && spots[4] === 2 && spots[6] === 2) {
        p2Win(2,4,6);
      } else if (turn === 9) {
        noWin();
      }
    }

    //Chooses where AI marks on the grid if p1 or AI is about to win
    function almostWin() {
      //check O's
      if (p2Mark.includes("0") && p2Mark.includes("1") && empty.includes("2")) {
        $('#grid2').text(p2xo);
      } else if (p2Mark.includes("0") && p2Mark.includes("2") && empty.includes("1")) {
        $('#grid1').text(p2xo);
      } else if (p2Mark.includes("0") && p2Mark.includes("3") && empty.includes("6")) {
        $('#grid6').text(p2xo);
      } else if (p2Mark.includes("0") && p2Mark.includes("4") && empty.includes("8")) {
        $('#grid8').text(p2xo);
      } else if (p2Mark.includes("0") && p2Mark.includes("6") && empty.includes("3")) {
        $('#grid3').text(p2xo);
      } else if (p2Mark.includes("0") && p2Mark.includes("8") && empty.includes("4")) {
        $('#grid4').text(p2xo);
      }

      //1's
      else if (p2Mark.includes("1") && p2Mark.includes("2") && empty.includes("0")) {
        $('#grid0').text(p2xo);
      } else if (p2Mark.includes("1") && p2Mark.includes("4") && empty.includes("7")) {
        $('#grid7').text(p2xo);
      } else if (p2Mark.includes("1") && p2Mark.includes("7") && empty.includes("4")) {
        $('#grid4').text(p2xo);
      }

      //2's
      else if (p2Mark.includes("2") && p2Mark.includes("6") && empty.includes("4")) {
        $('#grid4').text(p2xo);
      } else if (p2Mark.includes("2") && p2Mark.includes("4") && empty.includes("6")) {
        $('#grid6').text(p2xo);
      } else if (p2Mark.includes("2") && p2Mark.includes("5") && empty.includes("8")) {
        $('#grid8').text(p2xo);
      } else if (p2Mark.includes("2") && p2Mark.includes("8") && empty.includes("5")) {
        $('#grid5').text(p2xo);
      }

      //3's
      else if (p2Mark.includes("3") && p2Mark.includes("4") && empty.includes("5")) {
        $('#grid5').text(p2xo);
      } else if (p2Mark.includes("3") && p2Mark.includes("5") && empty.includes("4")) {
        $('#grid4').text(p2xo);
      } else if (p2Mark.includes("3") && p2Mark.includes("6") && empty.includes("0")) {
        $('#grid0').text(p2xo);
      }

      //4's
      else if (p2Mark.includes("4") && p2Mark.includes("5") && empty.includes("3")) {
        $('#grid3').text(p2xo);
      } else if (p2Mark.includes("4") && p2Mark.includes("6") && empty.includes("2")) {
        $('#grid2').text(p2xo);
      } else if (p2Mark.includes("4") && p2Mark.includes("7") && empty.includes("1")) {
        $('#grid1').text(p2xo);
      } else if (p2Mark.includes("4") && p2Mark.includes("8") && empty.includes("0")) {
        $('#grid0').text(p2xo);
      }

      //6
      else if (p2Mark.includes("6") && p2Mark.includes("7") && empty.includes("8")) {
        $('#grid8').text(p2xo);
      }

      //8's
      else if (p2Mark.includes("8") && p2Mark.includes("5") && empty.includes("2")) {
        $('#grid2').text(p2xo);
      } else if (p2Mark.includes("8") && p2Mark.includes("6") && empty.includes("7")) {
        $('#grid7').text(p2xo);
      } else if (p2Mark.includes("8") && p2Mark.includes("7") && empty.includes("6")) {
        $('#grid6').text(p2xo);
      }

      //check X's
      else if (p1Mark.includes("0") && p1Mark.includes("1") && empty.includes("2")) {
        $('#grid2').text(p2xo);
        empty.splice(empty.indexOf("2"), 1);
        p2Mark.push("2");
      } else if (p1Mark.includes("0") && p1Mark.includes("2") && empty.includes("1")) {
        $('#grid1').text(p2xo);
        empty.splice(empty.indexOf("1"), 1);
        p2Mark.push("1");
      } else if (p1Mark.includes("0") && p1Mark.includes("3") && empty.includes("6")) {
        $('#grid6').text(p2xo);
        empty.splice(empty.indexOf("6"), 1);
        p2Mark.push("6");
      } else if (p1Mark.includes("0") && p1Mark.includes("4") && empty.includes("8")) {
        $('#grid8').text(p2xo);
        empty.splice(empty.indexOf("8"), 1);
        p2Mark.push("8");
      } else if (p1Mark.includes("0") && p1Mark.includes("6") && empty.includes("3")) {
        $('#grid3').text(p2xo);
        empty.splice(empty.indexOf("3"), 1);
        p2Mark.push("3");
      } else if (p1Mark.includes("0") && p1Mark.includes("8") && empty.includes("4")) {
        $('#grid4').text(p2xo);
        empty.splice(empty.indexOf("4"), 1);
        p2Mark.push("4");
      }

      //1's
      else if (p1Mark.includes("1") && p1Mark.includes("2") && empty.includes("0")) {
        $('#grid0').text(p2xo);
        empty.splice(empty.indexOf("0"), 1);
        p2Mark.push("0");
      } else if (p1Mark.includes("1") && p1Mark.includes("4") && empty.includes("7")) {
        $('#grid7').text(p2xo);
        empty.splice(empty.indexOf("7"), 1);
        p2Mark.push("7");
      } else if (p1Mark.includes("1") && p1Mark.includes("7") && empty.includes("4")) {
        $('#grid4').text(p2xo);
        empty.splice(empty.indexOf("4"), 1);
        p2Mark.push("4");
      }

      //2's
      else if (p1Mark.includes("2") && p1Mark.includes("6") && empty.includes("4")) {
        $('#grid4').text(p2xo);
        empty.splice(empty.indexOf("4"), 1);
        p2Mark.push("4");
      } else if (p1Mark.includes("2") && p1Mark.includes("4") && empty.includes("6")) {
        $('#grid6').text(p2xo);
        empty.splice(empty.indexOf("6"), 1);
        p2Mark.push("6");
      } else if (p1Mark.includes("2") && p1Mark.includes("5") && empty.includes("8")) {
        $('#grid8').text(p2xo);
        empty.splice(empty.indexOf("8"), 1);
        p2Mark.push("8");
      } else if (p1Mark.includes("2") && p1Mark.includes("8") && empty.includes("5")) {
        $('#grid5').text(p2xo);
        empty.splice(empty.indexOf("5"), 1);
        p2Mark.push("5");
      }

      //3's
      else if (p1Mark.includes("3") && p1Mark.includes("4") && empty.includes("5")) {
        $('#grid5').text(p2xo);
        empty.splice(empty.indexOf("5"), 1);
        p2Mark.push("5");
      } else if (p1Mark.includes("3") && p1Mark.includes("5") && empty.includes("4")) {
        $('#grid4').text(p2xo);
        empty.splice(empty.indexOf("4"), 1);
        p2Mark.push("4");
      } else if (p1Mark.includes("3") && p1Mark.includes("6") && empty.includes("0")) {
        $('#grid0').text(p2xo);
        empty.splice(empty.indexOf("0"), 1);
        p2Mark.push("0");
      }

      //4's
      else if (p1Mark.includes("4") && p1Mark.includes("5") && empty.includes("3")) {
        $('#grid3').text(p2xo);
        empty.splice(empty.indexOf("3"), 1);
        p2Mark.push("3");
      } else if (p1Mark.includes("4") && p1Mark.includes("6") && empty.includes("2")) {
        $('#grid2').text(p2xo);
        empty.splice(empty.indexOf("2"), 1);
        p2Mark.push("2");
      } else if (p1Mark.includes("4") && p1Mark.includes("7") && empty.includes("1")) {
        $('#grid1').text(p2xo);
        empty.splice(empty.indexOf("1"), 1);
        p2Mark.push("1");
      } else if (p1Mark.includes("4") && p1Mark.includes("8") && empty.includes("0")) {
        $('#grid0').text(p2xo);
        empty.splice(empty.indexOf("0"), 1);
        p2Mark.push("0");
      }

      //6
      else if (p1Mark.includes("6") && p1Mark.includes("7") && empty.includes("8")) {
        $('#grid8').text(p2xo);
        empty.splice(empty.indexOf("8"), 1);
        p2Mark.push("8");
      }

      //8's
      else if (p1Mark.includes("8") && p1Mark.includes("5") && empty.includes("2")) {
        $('#grid2').text(p2xo);
        empty.splice(empty.indexOf("2"), 1);
        p2Mark.push("2");
      } else if (p1Mark.includes("8") && p1Mark.includes("6") && empty.includes("7")) {
        $('#grid7').text(p2xo);
        empty.splice(empty.indexOf("7"), 1);
        p2Mark.push("7");
      } else if (p1Mark.includes("8") && p1Mark.includes("7") && empty.includes("6")) {
        $('#grid6').text(p2xo);
        empty.splice(empty.indexOf("6"), 1);
        p2Mark.push("6");
      }

      // if none
      else {
        computerGo = true;
      }
    }

    //RESET FUNCTION TO RESET GAME AFTER A WIN OR DRAW
    function reset() {
      win = false;
      turn = 0;
      spots = [0, 0, 0, 0, 0, 0, 0, 0, 0];
      empty = ['6', '2', '0', '1', '3', '4', '8', '5', '7'];
      p1Mark = [];
      p2Mark = [];

      for (i = 0; el = document.getElementById(prefix + i); i++) {
        $(el).html("");
      }
      $("#gameboard").show();
      $('.playerOneTurn').animate({
        width: 'toggle'
      }, turnTime);
      return turn = 0;
    }

    //RESET FUNCTION TO RESET EVERYTHING
    function resetAll() {
      numPlayers = 0;
      p1xo = "";
      p2xo = "";
      win = false;
      turn = 0;
      p1WinCount = 0;
      p2WinCount = 0;
      computerWinCount = 0;
      spots = [0, 0, 0, 0, 0, 0, 0, 0, 0];
      empty = ['6', '2', '0', '1', '3', '4', '8', '5', '7'];
      p1Mark = [];
      p2Mark = [];

      $(".p1WinCount").html("0");
      $(".aiORp2WinCount").html("0");

      for (i = 0; el = document.getElementById(prefix + i); i++) {
        $(el).html("");
      }
      $("#gameboard").hide();
      $("#xo").hide();
      $("#winner").hide();
      $("#players").show();
      $(".playerOneTurn").hide();
      $(".playerTwoTurn").hide();
      $(".winCount").fadeTo( "slow", 0 );

      return turn = 0;
    }

    //WHAT TO DO IN DIFFERENT WIN/DRAW SCENARIOS
    function p1Win(x1, x2, x3) {
      win = true;
      p1WinCount++;

      document.getElementById(prefix + x1).style.backgroundColor = 'black';
      document.getElementById(prefix + x2).style.backgroundColor = 'black';
      document.getElementById(prefix + x3).style.backgroundColor = 'black';

      document.getElementById(prefix + x1).style.color = 'white';
      document.getElementById(prefix + x2).style.color = 'white';
      document.getElementById(prefix + x3).style.color = 'white';

      setTimeout(function () {
        document.getElementById(prefix + x1).style.backgroundColor = 'white';
        document.getElementById(prefix + x2).style.backgroundColor = 'white';
        document.getElementById(prefix + x3).style.backgroundColor = 'white';

        document.getElementById(prefix + x1).style.color = 'red';
        document.getElementById(prefix + x2).style.color = 'red';
        document.getElementById(prefix + x3).style.color = 'red';

        $(".p1WinCount").text(p1WinCount);
        $("#gameboard").hide();
        $(".playerOneTurn").hide();
        $(".playerTwoTurn").hide();
        $("#winner").text("Player 1 wins!").fadeIn().fadeOut(1000);
        setTimeout(function() {
          reset();
        }, 2001);
      }, 1500);
    }

    function p2Win(x1,x2,x3) {
      win = true;

      document.getElementById(prefix + x1).style.backgroundColor = 'black';
      document.getElementById(prefix + x2).style.backgroundColor = 'black';
      document.getElementById(prefix + x3).style.backgroundColor = 'black';

      document.getElementById(prefix + x1).style.color = 'white';
      document.getElementById(prefix + x2).style.color = 'white';
      document.getElementById(prefix + x3).style.color = 'white';

      setTimeout(function () {
        document.getElementById(prefix + x1).style.backgroundColor = 'white';
        document.getElementById(prefix + x2).style.backgroundColor = 'white';
        document.getElementById(prefix + x3).style.backgroundColor = 'white';

        document.getElementById(prefix + x1).style.color = 'red';
        document.getElementById(prefix + x2).style.color = 'red';
        document.getElementById(prefix + x3).style.color = 'red';
        $("#gameboard").hide();
        $(".playerOneTurn").hide();
        $(".playerTwoTurn").hide();
        if (numPlayers === 1) {
          $("#winner").text("Computer wins!").fadeIn().fadeOut(1000);
          computerWinCount++;
          $(".aiORp2WinCount").text(computerWinCount);
        } else if (numPlayers === 2) {
          $("#winner").text("Player 2 wins!").fadeIn().fadeOut(1000);
          p2WinCount++;
          $(".aiORp2WinCount").text(p2WinCount);
        }
        setTimeout(function() {
          reset();
        }, 2001);
      }, 1500);
    }

    function noWin() {
      win = true;
      $("#gameboard").hide();
      $(".playerOneTurn").hide();
      $(".playerTwoTurn").hide();
      $("#winner").text("It's a draw!").fadeIn().fadeOut(1000);
      setTimeout(function() {
        reset();
      }, 2001);
    }

  });
</script>
